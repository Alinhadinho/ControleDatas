# ==============================
# üêç Coletor App - Dockerfile
# Compat√≠vel com Render.com
# Vers√£o: 1.0.4-opencv-fix
# ==============================

# 1Ô∏è‚É£ Imagem base
FROM python:3.11-slim
LABEL build_version="1.0.4-opencv-fix"

# 2Ô∏è‚É£ Configura√ß√£o do ambiente
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1
ENV FLET_DISPLAY=false
ENV APP_HOME=/app
WORKDIR $APP_HOME

# 3Ô∏è‚É£ Instalar depend√™ncias do sistema (necess√°rias pro OpenCV)
RUN apt-get update && apt-get install -y --no-install-recommends \
    libgl1 \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

# 4Ô∏è‚É£ Copiar c√≥digo do app e depend√™ncias
COPY ./src ./src
COPY requirements.txt ./

# 5Ô∏è‚É£ Instalar depend√™ncias Python
RUN pip install --no-cache-dir -r requirements.txt

# 6Ô∏è‚É£ Criar diret√≥rios para dados e relat√≥rios
RUN mkdir -p data reports

# 7Ô∏è‚É£ Expor a porta usada pelo Render (Render usa vari√°vel $PORT)
EXPOSE 8080

# 8Ô∏è‚É£ Comando para rodar o app (Render usa CMD automaticamente)
CMD ["python", "src/main.py"]
